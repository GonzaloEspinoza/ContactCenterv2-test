@using Logica;
@using Entidad;
@using Entidad.Enums;
@using DataP;
@using Backend.Models;
@model ECliente
@{
    ViewBag.Title = ViewBag.Titulo;
    Layout = "~/Views/Shared/_Layout.cshtml";
    string accion = "Nuevo";
    try
    {
        accion = ViewBag.Accion;
    }
    catch
    {
        accion = "Nuevo";
    }
    string lblBotonGuardar = "Guardar";
    if (accion.ToUpper().Equals("NUEVO"))
    {
        lblBotonGuardar = "Guardar";
    }
    else
    {
        lblBotonGuardar = "Actualizar";
    }
    bool Habilitado = true;
    Habilitado = Model == null || (Model != null && Model.ClienteId == 0) ? true : Model.Estado == (int)Estado.Habilitado ? true : false;
    string check = Habilitado ? "true" : "false";
    List<EEmpresa> empresas = (List<EEmpresa>)ViewBag.empresas;

}
@section EtiquetaHead
{


    <link href="@Url.Content("~/Content/metronic/global/plugins/bootstrap-select/css/bootstrap-select.min.css")" rel="stylesheet" />
    <link href="@Url.Content("~/Content/map-google.css")" rel="stylesheet" />
    <link href="@Url.Content("~/Content/metronic/global/plugins/bootstrap-colorpicker/css/colorpicker.css")" rel="stylesheet" />
    <link href="@Url.Content("~/Content/metronic/global/plugins/jquery-minicolors/jquery.minicolors.css")" rel="stylesheet" />
    <link href="@Url.Content("~/Content/metronic/global/plugins/bootstrap-modal/css/bootstrap-modal-bs3patch.css")" rel="stylesheet" />
    <link href="@Url.Content("~/Content/metronic/global/plugins/bootstrap-modal/css/bootstrap-modal.css")" rel="stylesheet" />
    <script src="@Url.Content("~/Content/metronic/global/plugins/bootstrap-select/js/bootstrap-select.js")"></script>
    <link href="@Url.Content("~/Content/metronic/global/plugins/bootstrap-select/css/bootstrap-select.min.css")" rel="stylesheet" />
    <link href="@Url.Content("~/Content/metronic/global/plugins/bootstrap-fileinput/bootstrap-fileinput.css")" rel="stylesheet" />
    <script src="@Url.Content("~/Content/metronic/global/plugins/bootstrap-fileinput/bootstrap-fileinput.js")" type="text/javascript"></script>
    <link href="@Url.Content("~/Content/metronic/global/plugins/jquery-multi-select/css/multi-select.css")" rel="stylesheet" />
    <script src="@Url.Content("~/Content/metronic/global/plugins/jquery-multi-select/js/jquery.multi-select.js")"></script>
    <script src="@Url.Content("~/Content/metronic/global/plugins/jquery-multi-select/js/jquery.quicksearch.js")"></script>
    <script src="@Url.Content("~/Content/metronic/global/plugins/ckeditor/ckeditor.js")"></script>
    <script src="@Url.Content("~/Content/metronic/global/plugins/bootstrap-modal/js/bootstrap-modalmanager.js")"></script>
    <script src="@Url.Content("~/Content/metronic/global/plugins/bootstrap-modal/js/bootstrap-modal.js")"></script>
    <script src="@Url.Content("~/Content/metronic/global/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.js")"></script>
    <script src="@Url.Content("~/Content/metronic/global/plugins/jquery-minicolors/jquery.minicolors.min.js")"></script>
    <script src="@Url.Content("~/Content/metronic/pages/scripts/components-color-pickers.min.js")"></script>


    <script type="text/javascript">
        
        $(document).ready(function () {
            $('#Habilitado')[0].checked = @check;
            $('.bs-select').selectpicker({
                iconBase: 'fa',
                tickIcon: 'fa-check'
            });
           
        });
       
        function Procesar() {
            LimpiarMensaje();
            BloquearPantalla();
            $.ajax({
                url: "@Url.Action(accion, "cliente")",
                cache: false,
                data: {
                    id: $("#ClienteId").val(),
                    codigoCliente: $("#CodigoCliente").val(),
                    nombres:$("#Nombres").val(),
                    apellidos: $("#Apellidos").val(),
                    urlFoto: $("#UrlFoto").val(),
                    codigoPais: $("#CodigoPais").val(),
                    numeroCelular: $("#NumeroCelular").val(),
                    correo: $("#Correo").val(),
                    tokenNotificacionFirebase: $("#TokenNotificacionFirebase").val(),
                    tipoSistemaOperativo: $("#TipoSistemaOperativo").val(),
                    empresaId: $("#EmpresaId").val(),
                    habilitado: $("#Habilitado").is(":checked")
                },
                type: "POST",
                dataType: "script"
            }).complete(function (response) {

                DesbloquearPantalla();
            }).done(function () {
                DesbloquearPantalla();
            }).error(function () {
               DesbloquearPantalla();
            });

        }
        function volver() {
            $("#btn_cancelar").click();
            BloquearPantalla();
            redireccionar('@Url.Action("Index", "cliente")');
        }
    </script>
}

<div class="page-head">
    <div class="page-title">
        <h1>
            Clientes
            <small>@ViewBag.Title</small>
        </h1>
    </div>
</div>
<ul class="page-breadcrumb breadcrumb">
    <li>
        <a href="@Url.Action("Index", "Inicio")">Principal</a>
        <i class="fa fa-circle"></i>
    </li>
    <li>
        <a href="@Url.Action("Index", "cliente")">Clientes</a>
        <i class="fa fa-circle"></i>
    </li>
    <li>
        <span class="active">@ViewBag.Title</span>
    </li>
</ul>
<div class="row">
    <div class="col-md-12">
        <div class="panel">
            <div class="panel-body">
                
                @Html.HiddenFor(x => x.ClienteId)
                <div class="alert alert-danger" style="display:none" role="alert" id="mensajeError"></div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group form-md-line-input form-md-floating-label">
                            @Html.TextBoxFor(x => x.Nombres, new { @class = "form-control", @maxlength = "200" })
                            @Html.LabelFor(x => x.Nombres, "Nombres")
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group form-md-line-input form-md-floating-label">
                            @Html.TextBoxFor(x => x.Apellidos, new { @class = "form-control", @maxlength = "200" })
                            @Html.LabelFor(x => x.Apellidos, "Apellidos")
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <label>Empresa</label>
                        <div class="form-group">
                            <select class="bs-select form-control" id="EmpresaId" data-live-search="true">
                                @{
                                    if (Model.Empresa != null)
                                    {
                                        foreach (var item in empresas)
                                        {
                                            if (Model.Empresa.nEmpresaId == item.EmpresaId)
                                            {
                                                <option selected value="@item.EmpresaId">@item.Nombre</option>
                                            }
                                            else
                                            {
                                                <option value="@item.EmpresaId">@item.Nombre</option>
                                            }
                                        }
                                    }
                                    else
                                    {
                                        foreach (var item in empresas)
                                        {
                                            <option value="@item.EmpresaId"> @item.Nombre </option>
                                        }

                                    }
                                }
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group form-md-line-input form-md-floating-label">
                            @Html.TextBoxFor(x => x.Correo, new { @class = "form-control", @maxlength = "200" })
                            @Html.LabelFor(x => x.Correo, "Correo")
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group form-md-line-input form-md-floating-label">
                            @Html.TextBoxFor(x => x.CodigoPais, new { @class = "form-control", @maxlength = "200" })
                            @Html.LabelFor(x => x.CodigoPais, "Codigo pais")
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group form-md-line-input form-md-floating-label">
                            @Html.TextBoxFor(x => x.NumeroCelular, new { @class = "form-control", @type = "number" })
                            @Html.LabelFor(x => x.NumeroCelular, "Numero celular")
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group form-md-line-input form-md-floating-label">
                            @Html.TextBoxFor(x => x.UrlFoto, new { @class = "form-control", @maxlength = "200" })
                            @Html.LabelFor(x => x.UrlFoto, "Url foto")
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group form-md-line-input form-md-floating-label">
                            @Html.TextBoxFor(x => x.TokenNotificacionFirebase, new { @class = "form-control", @maxlength = "200" })
                            @Html.LabelFor(x => x.TokenNotificacionFirebase, "Token notificacion firebase")
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group form-md-line-input form-md-floating-label">
                            @Html.TextBoxFor(x => x.TipoSistemaOperativo, new { @class = "form-control", @maxlength = "200" })
                            @Html.LabelFor(x => x.TipoSistemaOperativo, "Tipo sistema operativo")
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group form-md-line-input form-md-floating-label">
                            @Html.TextBoxFor(x => x.CodigoCliente, new { @class = "form-control", @maxlength = "200" })
                            @Html.LabelFor(x => x.CodigoCliente, "Codigo Cliente")
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <br /><br />
                        <div class="md-checkbox">
                            <input type="checkbox" id="Habilitado" class="md-check">
                            <label for="Habilitado" title="">
                                <span></span>
                                <span class="check"></span>
                                <span class="box"></span> Habilitado
                            </label>
                        </div>

                    </div>


                    <div class="col-md-12">
                        <br />
                        <button class="btn btn-default" onclick="volver();">Volver</button>
                        <input type="button" value="@lblBotonGuardar" class="btn btn-success" onclick="Procesar()" />
                    </div>
                </div>
                <br><br>
            </div>
        </div>
    </div>
</div>


